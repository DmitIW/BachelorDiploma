\usepackage{amsmath}

% В этом файле следует писать текст работы, разбивая его на
% разделы (section), подразделы (subsection) и, если нужно,
% главы (chapter).

% Предварительно следует указать необходимую информацию
% в файле SETUP.tex

\input{preamble.tex}

\begin{document}

\Intro

В рамках данной работы освещается вопрос семантического анализа изображений путем применения глубоких сверточных нейронных сетей.
Под семантическим анализом понимается получение из изображения какой-либо интерпретируемой информации: расположение объектов на сцене,
принадлежность объектов к заранее заданным классам, наличие на изображении объектов определенного типа и т.п..
Данная тема будет рассмотрена на примере задачи обнаружения и выделения неба на изображениях.
Входными данными задачи являются фотографии, сделанные на камеры мобильных устройств.
Специализированный домен изображений был выбран с целью упрощения адаптация потенциального решения к применению в конечных продуктах,
таких как пользовательское программное обеспечение для смартфонов.
Решением задачи выступают сгенерированные для входных фотографий полутоновые изображения.
Такое изображение называется сегментационной маской и для каждого пикселя исходной фотографии выражает его принадлежность
к региону неба: белый цвет интерпретируется как положительный результат, черный - как отрицательный.
В ходе разарботки алгоритма решения задачи была исселдована эффективность применения различных подходов к генерации подобного рода масок - сегментации.
Сравнения эффективности проходило по индексу Жаккара - в западной литературе также встречается название intersection over union, IoU.
Для решения задачи сегментации из наиболее эффективных подходов был составлен стек алгоритмов: применение к входному изображению глубокой сверточной сети
с последующей корректировкой методами компьютерного зрения полученной маски.
В ходе обучения модели искусственной нейронной сети, ИНС, для предотвращения переобучения и улучшения сходимости
применялись техники регуляризация, такие как learning rate reduce и one cycle policy.
Влияние данных подходов на решение также отражено в результатах работы.
В заключительной части хода разработки была рассмотрена возможность адаптация модели, обученной на данных датасета SkyFinder,
к выбранному домену изображений.
Данная техника имеет название Domain Adaptation и используется для улучшения качества на практических данных.

% Если typeOfWork в SETUP.tex задан как 2 или 3, то начинать
% надо не с section (раздел), а с главы (chapter)

\section{Постановка и описание задачи}

Цифровая обработка изображений являются комплексной темой.
В нее входят задачи фильтрации, цветовых и яркостных
преобразований, морфологическая обработка, распознавание и выделение объектов на сцене~\autocite{gonzalez2008digital}.
Семантический анализу - подход, целью которого является получение интерпретируемой информации высших порядков об изображении.
К подзадачам семантического анализа можно отнести классификацию объектов на сцене, детекцию объектов и сегментацию изображений на семантические регионы.
В рамках текущей работы будет проведен разбор подзадачи сегментации.

\subsection{Задача сегментации}

Для возможности цифровой обработки и анализа будем рассматривать представление изображения как трехмерного массива чисел,
имеющего ширину, количество столбцов, и высоту, количество строк, равными ширине и высоте изображения соответсвенно.
На каждой позиции по ширине и высоте будет находится вектор из трех целых чисел, из промежутка [0, 255], что
соответсвует RGB модели представления цвета пикселя изображения.
В таком случае сегментацией изображения будет являться отображение каждого RGB вектора в некоторое целое число.
Это число соответствует идентификатору некоторого класса.
При применение такого отображения ко всему изображению получается двумерный массив, ширина и высота которого
соответсвуют таковым у исходного изображения.
Подобный двумерный массив будет разделять изображение на регионы по обозначенному признаку и называться сегментационной маской.
Сегментацию возможно рассматривать как попиксельную классификацию объектов.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{img/example_segmentation.png}
    \caption{Общий вид сегментации на примере данных датасета COCO}
    \label{fig:seg_example}
\end{figure}

Отметим, что описанное выше отображение может обладать относительно простой природой и учитывать только значение пикселя в конкретной позиции,
так и более сложной структурой, использующей информацию о распределении цветов во всем изображении, положении пикселя на изображении и
свойствах соседних пикселей, непосредственно соседствующих с обозреваемым значением или отсупающих от него на заданное смещение~\autocite{liu2018recent}.
На~\ref{fig:seg_example} показан общий вид задачи сегментации изображения.

\subsection{Выделение неба в рамках задачи сегментации}

Описанная в введение задача выделения региона неба на входном изображении может быть рассмотрена как задача сегментации.
Так как в данном случае результирующих классов всегда два - класс принадлежности и обратный ему -, то имеется более узкий случай сегментации - бинарная.
Итоговая маска будет содержать только значения 0 и 1, представляя собой однобитовое бинарное изображение, что можно считать вырожденным полутоновым.

Таким образом, решение задачи выделения неба сводится к нахождению отображения из вектора цветов для каждого пикселя в целое число из промежутка [0, 1].
Данное отображение возможно получить как алгоритмами машинного зрения, так и с помощью использования моделей глубоких сверточных нейронных сетей.
В данной работе приводится решение методом нейронных сетей, при этом алгоритмы компьютерного зрения используются для корректировки полученной маски.
Под корректировкой здесь понимается обнаружение и удаление ложноположительных регионов неба небольшой площади.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{img/sky_segmentation.png}
    \caption{Пример, демонстрирующий работу алгоритма}
    \label{fig:sky_seg}
\end{figure}

Практическое применение подобного решения можно найти в пользовательских приложениях эстетической обработки пейзажных фотографий для смартфонов,
в автоматических системах мониторинга воздушного пространства, при извлечении семантической информации высшего порядка для использования в иных методах анализа
и обработки изображений~\autocite{7415405}.

\section{Обзор решений}

Задача семантического анализа изображений имеет широкое применение при решении различных прикладных и исследовательских
проблем~\autocite{maier2018gentle}~\autocite{pan2019image}~\autocite{stabinger2020evaluating}~\autocite{li2015brief},
в связи с чем активно изучается.
Сегментации изображений, в частности, нашли применения в таких областях как проведение хирургических операций,
автопилотируемый транспорт, автоматизированное картографирование местности~\autocite{liu2018recent}.
Ниже приведен краткий обзор исследований, темы которых связаны с поставленной задачей.
Результаты этих исследований в разной степени использовались для построения решения.

\subsection{Сегментация изображений}

До начала активного применения глубоких нейронных сетей в задачах сегментации использовались методы компьютерного зрения,
основанные на применении порогов бинаризации для полутоновых изображений, выявлении признаков,
кластеризации методом k-средних~\autocite{10.5555/1888028.1888043}~\autocite{10.5555/540298}~\autocite{inproceedings}.
Каждый из этих подходов имеет свои приемущества, метод бинарной сегментации полутоновых изображений до сих пор успешно применяется
в области анализа медицинских данных~\autocite{bookMedicalImages}.
Но применение данных подходов к задаче выделения границы между объектами путем сегментации показало худшие результаты в сравнении с FCN,
полностью сверточными глубокими сетями~\autocite{7966418}.

Современные решения задачи сегментации в различных областях зачастую опираются на применение нейронных сетей~\autocite{feng2019deep}.
Наиболее распространенными архитектурами выступают Unet, DeepLab, RefineNet~\autocite{ronneberger2015unet}~\autocite{chen2016deeplab}~\autocite{lin2016refinenet}.
Имеются исследования применения архитектуры RefineNet для определния региона неба на датасете SkyFinder~\autocite{place2017segmenting}.

\subsection{Методы регуляризации}

Помимо специализированных решений задачи сегментации, были рассмотрены также общие методики, применяемые для обучения глубоких нейронных сетей.
При высокой сложности модели, в процессе обучения она может начать отражать в ответах шум в тренировачных данных~\autocite{salman2019overfitting}~\autocite{ghojogh2019theory}.
Данное явление называется переобучением, overfitting.
С целью снизить вероятность его проявление применяются разнообразные техники регуляризации: dropout, нормализация значений между слоями сети,
настройка гиперпараметров процесса обучения~\autocite{smith2018disciplined}~\autocite{labach2019survey}~\autocite{ioffe2015batch}.

\section{Метод решения}

Конечное решение задачи сегментации имеет комплексное строение.
Изображение, поступающее на вход решающему алгоритму, обрабатывается ИНС.
Результатом такого применения является двумерный массив пар.
Каждое значение в паре обозначет вероятность принадлежности одному из двух классов.
Для получения сегментационной маски индекс максимального из двух значений расценивается как идентификатор класса: 1 для региона неба, 0 - обратный ему.
В ходе экспериментов было выявлено наличие артефактов в результатах классификации.
Для части изображений имелись ложноположительные регионы неба небольшой площади.
Для их устранения последовательно применялись алгоритмы FindCounters и DrawCounters из состава библиотеки OpenCV.

Для обучения сети использовался датасет SkyFinder.
Для улчушения показателя IoU на целевом домене изображений использовалась техника Unsupervised Domain Adaptation.
Это позволило уменшить количество ложноположительных и ложноотрицательных регионов без дополнительной разметки обучающий выборки из фотографий,
сделанных на мобильные устройства.

\subsection{Глубокая сверточная сеть}

Как было отмечено выше, текущие исследования указывают на приемущества глубоких сверточных сетей в задачах семантического анализа
перед классическими алгоритмами компьютерного зрения.
Глубокими сверточными сетями называют подвид искуственных нейронных сетей, все слои которой являются сверточными.

Архитекутра сети для решения задачи сегментации представляется двумя частями.
Выделение признаков, downsampling path, и генерализация результатов выделения, upsampling path.
Для решения проблемы потери информации в сверточных слоях, карты признаков с некоторых уровней нисходящей части объединяют с противополженными входами восходящей части.
На~\ref{fig:net_arch_common} приведена общая схема сети для задач сегментации.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{img/net_arch.png}
    \caption{Общий вид глубокой сверточной сети для задачи сегментации}
    \label{fig:net_arch_common}
\end{figure}

В нисхоядщей части используются обычные сверточные слои, слои с выбором наибольшего значения по ядру - max pooling.
На сверточных слоях к входным данным применяются ядра свертки.
Количество ядер определяет для слоя количество выходных карт признаков.
Выходные карты признаков подаются на вход следующему слою.
К выходным картам применяется функция активации.
Значения в ядрах свертки являются тренируемыми параметрами сети.
Ниже приведена формула для простого случая двумерного входного массива и двумерного ядра свертки~\eqref{eq:1}.

\begin{equation}
    \label{eq:1}
    G[m, n] = (f*h)[m, n] = \sum_{j}{\sum_{k}{h[j, k]f[m + j, n + k]}}
\end{equation}

где f - входной массив данных, h - ядро свертки, G - выходная карта признаков.

Размеры каждой карты определяются размерами входных данных, размерами ядра, размером добавочного отступа по краям массива данных и сдвигом,
на которое ядро смещается по массиву~\eqref{eq:2}.

\begin{equation}
    \label{eq:2}
    output = \frac{input + 2 * a - k}{s} + 1
\end{equation}

где output - размеры выходной карты признаков, input - размеры входного массива данных, a - величина отсутпа, добавляемого к краям массива,
k - размеры ядра свертки, s - сдвиг ядра.

В слоях с выбором наибольшего значения ядро задает только размеры окна, в котором выбирается максимальный элемент.
Операции сложения и умножения на этом слое не используются.


\section{Данные}

Эксперименты с обучением модели ИНС проводились на двух наборах данных: SkyFinder и набор из фотографий, сделанных на камеры смартфонов,
с синтетической разметкой в объединении с данными из SkyFinder.

\subsection{Датасет SkyFinder}

SkyFinder представляет собой набор из 90.000 фотографий~\autocite{mihail2016sky}.
Все фотографии сделаны на статичные веб-камеры, расположенные вне зданий.
В верхней части изображений преобладает регион неба.
Средний процент пикселей относящихся к классу принадлжености равен 41 со стандартным отклонением в 16 процентов.
Изображения покрывают широкий диапозон освещенности и погодных условий, что препятсвует переобучению на конкретных значениях.
Для каждого изображения имеется размеченная бинарная маска с описанным в постановке задачи свойством: 1 обозначает класс принадлежности, 0 - обратный ему.

\subsection{Датасет с синтетической разметкой}

\Conc

% Печать списка литературы (библиографии)
\printbibliography[%{}
    heading=bibintoc%
%,title=Библиография % если хочется это слово
]
% Файл со списком литературы: biblio.bib
% Подробно по оформлению библиографии:
% см. документацию к пакету biblatex-gost
% http://ctan.mirrorcatalogs.com/macros/latex/exptl/biblatex-contrib/biblatex-gost/doc/biblatex-gost.pdf
% и огромное количество примеров там же:
% http://mirror.macomnet.net/pub/CTAN/macros/latex/contrib/biblatex-contrib/biblatex-gost/doc/biblatex-gost-examples.pdf

\end{document}
